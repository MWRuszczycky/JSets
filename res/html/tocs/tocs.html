<!DOCTYPE html>
<html>
    <head>
@{meta}

<!-- ============================================================ -->
<!-- STYLES -->

        <style>
            body { background-color: white;
                   color: #101010;
                   font-family: sans-serif;
                   font-size: 100%; }
            a:link { color: #4682b4; }
            a:visited { color: #7eaacd; }
            p.selected a:link { color: #9c3030; }
            p.selected a:visited { color: #c33c3c; }
            p { display: block;
                padding-left: 2.5em;
                text-indent: -1.7em; }
        </style>

<!-- ============================================================ -->
<!-- SCRIPTS -->

        <script>

            jsetHeader = "@{jsetHeader}";
            savePrefix = "@{savePrefix}";

            class JournalIssue {
                constructor(key, name, volume, issue, published){
                    this.key = key;
                    this.name = name;
                    this.volume = volume;
                    this.issue = issue;
                    this.published = published;
                };
                header(){
                    var volNo   = this.volume + ":" + this.issue;
                    var pubdate = "(" + this.published + ")";
                    return this.name + " " + volNo + " " + pubdate;
               };
            };

            issues = [
@{issues}
                     ];

            function isAlphaNum(x) {
            // Determine if character is alpha-numeric.
                if (x.length === 1) {
                    var v     = x.charCodeAt(0);
                    var isNum = (v > 47 && v < 58);
                    var isCap = (v > 64 && v < 91);
                    var isLow = (v > 96 && v < 123);
                    return isNum || isCap || isLow;
                };
                return false;
            };

            function makeFileName(prefix, xs) {
            // Generate a file name for the selection.
                var suffix = "";
                for (i = 0; i < xs.length; i++) {
                    if (isAlphaNum(xs[i])) {
                        suffix += xs[i];
                    };
                };
                if (suffix) {
                    return prefix + "-" + suffix + ".txt";
                };
                return prefix + "-" + "none.txt";
            };

            function createSelection() {
            // Create selection content for saving and update page.
                var selection = jsetHeader + "\n";
                var count     = 0;
                for (i = 0; i < issues.length; i++ ){
                    selection += issues[i].header() + "\n";
                    var xs = document.getElementsByClassName(issues[i].key);
                    var pmids = ""
                    for (j = 0; j < xs.length; j++){
                        if (xs[j].checked) {
                            pmids += "    " + xs[j].id + "\n";
                            count += 1;
                        };
                    };
                    selection += pmids;
                };

                var inst          = document.getElementById('inst');
                var saveLink      = document.getElementById('saveLink');
                var createWgt     = document.getElementById('createWgt');
                var initials      = document.getElementById('initials');
                var fileNameWgt   = document.getElementById('fileNameWgt');
                var countWgt      = document.getElementById('count');
                var payload       = encodeURIComponent(selection);
                var fileName      = makeFileName(savePrefix, initials.value);

                saveLink.href     = "data:text/plain;charset=utf-8," + payload;
                saveLink.download = fileName;

                fileNameWgt.innerHTML = fileName;
                countWgt.innerHTML    = count;
                inst.style            = "display:block";
                createWgt.style       = "display:none";
            };

        </script>

    </head>

<!-- ============================================================ -->
<!-- CONTENT -->

    <body>

<!-- ============================================================ -->
<!-- Tables of Contents -->

        <h1>@{title}</h1>

@{instr}
@{tocs}
<!-- ============================================================ -->
<!-- Selection -->

@{saveinstr}
    </body>

</html>
